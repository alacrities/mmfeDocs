{\it Note that all the text in this section needs to be properly formatted and updated.}


%%%%%%%%% Sample inclusion of a figure
 % \begin{figure}[h]
 % \begin{center}
 % \includegraphics[width=0.8\textwidth]{specs/Diagram-TTCSync}
 % \caption{Block diagram of an implementation of the TTC syncronization.}
 % \label{fig:Monitoring}
 % \end{center}
 % \end{figure}


Summary of items:

2.	Receive fiber optics from TGC router

3.	Deserialize ART data, convert address into slope coordinates


\subsubsection{Receive ART signals from ADDC cards}

The ART data from an entire wedge will be transmitted to a single
trigger processor via 32 ADDCs. This results in 32 total fibers per
Trigger Processor to receive the art data from one wedge. Since the
MM and sTGC trigger processors will share the same ATCA carrier card,
each carrier will support two wedges.

The ART Data from the ADDC will be transmitted using the GigaBit Transceiver
(GBT) architecture and transmission protocol in a low-latency widebus
mode. The Trigger Processor will take advantage of the GBT firmware
developed by GBT Project to implement the receivers.

The GBT packet in widebus mode will provide 112 data bits and arrives
once every bunch crossing. One ADDC will service 32 VMMs and each
packet can contain ART data from a maximum of eight triggered VMMs. Each
VMM will be uniquely identifed to determine which micromegas strip
on the wedge was hit.

There are two options for how data packet bits will be defined. The
difference between the two is how the VMM ID information is encoded.
The first data protocol option will provide the VMM IDs of every VMM
that was triggered by asserting a bit in a 32-bit hit list. The second
option will encode each VMM ID in a list. For both options the triggered
strip number within each VMM will be provided in a list. The first
option would move the VMM ID encoding task from the ADDC ASIC to the
Trigger Processor FPGA.
Both options, shown below, use the full 112~bits provided by the GBTx' wide mode.


% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
  \centering
 % \caption{ARTfmt_opt1}
    \begin{tabular}{|c|c|c|c|c|c|}
    \hline
    0b1010 & BCID(12) & err\_flags(8) & hit\_list(32) & ART\_data\_parity(8) & 8xARTdata(6) \\
    \hline
    \end{tabular}%
%  \label{tab:ARTfmt_opt1}%
\end{table}%

% Table generated by Excel2LaTeX from sheet 'Sheet1'
\begin{table}[htbp]
  \centering
%  \caption{ARTfmt_opt2}
    \begin{tabular}{|c|c|c|c|c|}
    \hline
    hit\_cnt(3) & BCID(12) & 8xVMMID(5) & ART\_data\_parity(8) & 8xARTdata(6) \\
    \hline
    \end{tabular}%
%  \label{tab:ARTfmt_opt2}%
\end{table}%


\begin{comment}
{\small
\begin{tabular}{|c|c|c|c||c|c|}
\hline
\multicolumn{6}{|c|}{Option 1 GBT DATA{[}111:0{]}}\tabularnewline
\hline
\hline
``1010''  & BCID{[}11:0{]}  & ERR\_FLAGS{[}7:0{]}  & HIT\_LIST{[}31:0{]}  & ART\_PARITY{[}7:0{]}  & 8 x ARTDATA{[}5:0{]}\tabularnewline
\hline
\end{tabular}

\begin{tabular}{|c|c|c||c|c||c|}
\hline
\multicolumn{6}{|c|}{Option 2 GBT DATA{[}111:0{]}}\tabularnewline
\hline
\hline
HIT\_CNT{[}3:0{]}  & BCID{[}11:0{]}  & \multicolumn{2}{c|}{8 x VMMID{[}4:0{]}} & ART\_PARITY{[}7:0{]}  & 8 x ARTDATA{[}5:0{]}\tabularnewline
\hline
\end{tabular}
}  % end small

\end{comment}

\begin{itemize}
\item HIT\_LIST{[}31:0{]} = 32-bit list of flags corresponding to each of
the 32 VMMs. 0 - no hit, 1 - hit. A register controls if this is a
filtered (i.e. 8 hits max) or an un- filtered copy of the VMM flags
registered in a particular BC.
\item HIT\_CNT{[}3:0{]} = number of hits (range 0 - 8; 9 - 15 invalid)
\item ARTDATA\_PARITY{[}7:0{]} = parity bit of the ART data computed by
each of the 32 ART de-serializer units. Each bit corresponds to one
of the ART data field selected by the priority unit.
\end{itemize}

\begin{center}
\includegraphics[width=0.6\textwidth]{figures/specs/addcGbtFormat2.png}
%\includegraphics[bb=0 0 200 100,draft,type=eps,bb = 0 0 200 100, draft, type=eps]{figures/specs/addcGbtFormat2.png}
\end{center}

1. Receive fiber optic ART signals from ADDC cards  -  32 per wedge, 4 wedges total per card

Receive VTRx signals, bit rate of 4.2 Gbps

ART latency 50 nsec, Xmit latency 150 nsec, of VTRx, transit time 450 nsec

Data received asynchronously

Up to six ART hits per fiber in one transmission

Data field is geographic address header of the ADDC card, number of ART signals, followed by a stream of data that is a 5 bit geographic address of VMM 11 bit address of strip,  and 12 bit BCID

1.1.	Steps required for receiving ART data

1.1.1.	 VTTx (or VTRx) lock

1.2.	Failure modes and recovery

1.2.1.	Failure to get transceiver lock

\subsubsection{Deserialize ART data}

2.	Deserialize ART data, convert address into slope coordinates

Check geographic address of ADDC card in debug mode for cabling

Form 28 bit words for each ART hit

Convert word into slope coordinate

2.1.	Steps required for deserialization and conversion

2.1.1.	Form 28 bit words

2.1.2.	Use look-up table to convert VMM ASIC address and strip address into a   slope coordinate

2.1.3.	Compare BCID from ADDC to expected BCID from internal counter (plus delay)

2.1.4.

2.2.	Failure modes and recovery

2.2.1.	Geographic address of ADDC card doesn’t match expectation (debug mode)

2.2.2.	BCID doesn’t match expected BCID from internal counter


